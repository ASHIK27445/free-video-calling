<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FreeVideoCall - Simple P2P Video Calling</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Your existing CSS remains the same */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --secondary: #7209b7;
            --success: #4cc9f0;
            --danger: #f72585;
            --dark: #212529;
            --light: #f8f9fa;
            --gray: #6c757d;
            --border-radius: 12px;
            --box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }
        
        body {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: var(--dark);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            width: 100%;
            max-width: 1400px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            width: 100%;
        }
        
        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .logo-icon {
            background: var(--primary);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--box-shadow);
        }
        
        .logo-icon i {
            font-size: 24px;
            color: white;
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            color: white;
            font-weight: 700;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto 20px;
            color: rgba(255, 255, 255, 0.8);
        }
        
        .card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
            width: 100%;
            max-width: 500px;
            margin-bottom: 30px;
        }
        
        .card-header {
            background: var(--primary);
            color: white;
            padding: 20px;
            text-align: center;
            font-weight: 600;
            font-size: 1.3rem;
        }
        
        .card-body {
            padding: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }
        
        input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: var(--light);
            font-size: 1rem;
            transition: var(--transition);
        }
        
        input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: var(--secondary);
            color: white;
        }
        
        .btn-secondary:hover {
            background: #6511a0;
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn-danger:hover {
            background: #e11d74;
            transform: translateY(-2px);
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
        }
        
        .btn-group .btn {
            flex: 1;
        }
        
        .video-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            width: 100%;
            margin-bottom: 30px;
        }
        
        .video-wrapper {
            flex: 1;
            min-width: 300px;
            max-width: 600px;
            background: var(--dark);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--box-shadow);
            position: relative;
        }
        
        .video-header {
            padding: 15px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            z-index: 10;
        }
        
        .video-header span {
            font-weight: 600;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }
        
        .indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--danger);
        }
        
        .indicator.active {
            background: var(--success);
        }
        
        video {
            width: 100%;
            height: 350px;
            object-fit: cover;
            display: block;
            background: #000;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .control-btn {
            padding: 12px 20px;
            border-radius: 50px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            background: white;
            color: var(--dark);
            border: none;
            box-shadow: var(--box-shadow);
            cursor: pointer;
            transition: var(--transition);
        }
        
        .control-btn:hover {
            transform: translateY(-3px);
        }
        
        .control-btn.active {
            background: var(--primary);
            color: white;
        }
        
        .control-btn.danger {
            background: var(--danger);
            color: white;
        }
        
        .connection-status {
            margin-top: 20px;
            padding: 15px 25px;
            border-radius: 50px;
            font-weight: 600;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: var(--box-shadow);
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--danger);
        }
        
        .status-dot.connected {
            background: var(--success);
        }
        
        .hidden {
            display: none;
        }
        
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 20px;
            background: var(--dark);
            color: white;
            border-radius: 8px;
            box-shadow: var(--box-shadow);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1000;
            transform: translateY(100px);
            opacity: 0;
            transition: var(--transition);
        }
        
        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        .toast i {
            color: var(--success);
        }
        
        .permissions {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .permissions i {
            color: #856404;
            font-size: 1.2rem;
        }
        
        .participants {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .participant-badge {
            background: var(--primary);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
        }
        
        .copy-btn {
            background: var(--secondary);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-left: 10px;
        }
        
        @media (max-width: 768px) {
            .video-wrapper {
                min-width: 100%;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .controls {
                gap: 10px;
            }
            
            .control-btn {
                padding: 10px 15px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-video"></i>
                </div>
                <h1>FreeVideoCall</h1>
            </div>
            <p class="subtitle">Simple, free video calling for everyone. No signup required.</p>
        </header>
        
        <div id="setupInterface">
            <div class="card">
                <div class="card-header">
                    Start or Join a Video Call
                </div>
                <div class="card-body">
                    <div class="permissions">
                        <i class="fas fa-info-circle"></i>
                        <div>
                            <strong>How it works:</strong> Create a room or join with a room ID. Share the ID with your friend.
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="roomId">Room ID</label>
                        <input type="text" id="roomId" placeholder="Enter room ID or leave empty to generate">
                    </div>
                    
                    <div class="btn-group">
                        <button id="createRoomBtn" class="btn btn-primary">
                            <i class="fas fa-plus-circle"></i>
                            Create Room
                        </button>
                        <button id="joinRoomBtn" class="btn btn-secondary">
                            <i class="fas fa-sign-in-alt"></i>
                            Join Room
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="callInterface" class="hidden">
            <div class="video-container">
                <div class="video-wrapper">
                    <div class="video-header">
                        <span>You</span>
                        <div class="status-indicator">
                            <div class="indicator active" id="localVideoIndicator"></div>
                            <span>Live</span>
                        </div>
                    </div>
                    <video id="localVideo" autoplay muted playsinline></video>
                </div>
                <div class="video-wrapper">
                    <div class="video-header">
                        <span>Remote Participant</span>
                        <div class="status-indicator">
                            <div class="indicator" id="remoteVideoIndicator"></div>
                            <span id="remoteStatusText">Connecting...</span>
                        </div>
                    </div>
                    <video id="remoteVideo" autoplay playsinline></video>
                </div>
            </div>
            
            <div class="controls">
                <button id="toggleVideo" class="control-btn active">
                    <i class="fas fa-video"></i>
                    Video On
                </button>
                <button id="toggleAudio" class="control-btn active">
                    <i class="fas fa-microphone"></i>
                    Audio On
                </button>
                <button id="screenShare" class="control-btn">
                    <i class="fas fa-desktop"></i>
                    Share Screen
                </button>
                <button id="endCallBtn" class="control-btn danger">
                    <i class="fas fa-phone-slash"></i>
                    End Call
                </button>
            </div>
            
            <div class="connection-status">
                <div class="status-dot" id="connectionStatusDot"></div>
                <span id="connectionStatusText">Connecting to signaling server...</span>
            </div>
            
            <div class="card" style="max-width: 800px; margin-top: 20px;">
                <div class="card-header">
                    Room Information
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label>Room ID: <strong id="currentRoomId">-</strong>
                            <button class="copy-btn" id="copyRoomIdBtn">
                                <i class="fas fa-copy"></i> Copy
                            </button>
                        </label>
                        <p>Share this ID with your friend to join the call</p>
                    </div>
                    <div class="form-group">
                        <label>Participants in room:</label>
                        <div class="participants" id="participantsList">
                            <div class="participant-badge">You</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="toast" class="toast">
            <i class="fas fa-check-circle"></i>
            <span id="toastMessage">Room created successfully!</span>
        </div>
    </div>

<script>
    // DOM Elements
    const setupInterface = document.getElementById('setupInterface');
    const callInterface = document.getElementById('callInterface');
    const roomIdInput = document.getElementById('roomId');
    const createRoomBtn = document.getElementById('createRoomBtn');
    const joinRoomBtn = document.getElementById('joinRoomBtn');
    const localVideo = document.getElementById('localVideo');
    const remoteVideo = document.getElementById('remoteVideo');
    const toggleVideoBtn = document.getElementById('toggleVideo'); // Changed name
    const toggleAudioBtn = document.getElementById('toggleAudio'); // Changed name
    const screenShareBtn = document.getElementById('screenShare');
    const endCallBtn = document.getElementById('endCallBtn');
    const connectionStatusDot = document.getElementById('connectionStatusDot');
    const connectionStatusText = document.getElementById('connectionStatusText');
    const localVideoIndicator = document.getElementById('localVideoIndicator');
    const remoteVideoIndicator = document.getElementById('remoteVideoIndicator');
    const remoteStatusText = document.getElementById('remoteStatusText');
    const toast = document.getElementById('toast');
    const toastMessage = document.getElementById('toastMessage');
    const currentRoomId = document.getElementById('currentRoomId');
    const participantsList = document.getElementById('participantsList');
    const copyRoomIdBtn = document.getElementById('copyRoomIdBtn');

    // App State
    let localStream = null;
    let remoteStream = null;
    let peerConnection = null;
    let isVideoOn = true;
    let isAudioOn = true;
    let isScreenSharing = false;
    let roomId = null;
    let socket = null;

    // WebRTC Configuration
    const configuration = {
        iceServers: [
            { urls: 'stun:stun.l.google.com:19302' },
            { urls: 'stun:stun1.l.google.com:19302' },
            { urls: 'stun:stun2.l.google.com:19302' },
            { urls: 'stun:stun3.l.google.com:19302' }
        ]
    };

    // Get backend URL - FIXED with your Railway URL
    function getBackendUrl() {
        // Always use your Railway URL for now
        return 'wss://free-video-calling-production.up.railway.app';
    }

    // Initialize the application
    async function init() {
        try {
            console.log('ðŸš€ Initializing application...');
            
            // Request camera and microphone access first
            await getLocalStream();
            
            // Set up event listeners
            setupEventListeners();
            
            showToast('Application ready. Create or join a room to start calling.');
        } catch (error) {
            console.error('Error initializing application:', error);
            showToast('Error accessing camera/microphone: ' + error.message, true);
        }
    }

    // Connect to WebSocket signaling server
    function connectSignalingServer() {
        return new Promise((resolve, reject) => {
            const serverUrl = getBackendUrl();
            console.log('ðŸ”— Connecting to:', serverUrl);
            
            socket = new WebSocket(serverUrl);
            
            socket.onopen = () => {
                console.log('âœ… Connected to signaling server');
                updateConnectionStatus('Connected to server', 'success');
                resolve();
            };
            
            socket.onerror = (error) => {
                console.error('âŒ WebSocket error:', error);
                showToast('Failed to connect to server', true);
                reject(new Error('Failed to connect to signaling server'));
            };
            
            socket.onmessage = (event) => {
                try {
                    const message = JSON.parse(event.data);
                    console.log('ðŸ“¨ Received:', message.type);
                    handleSignalingMessage(message);
                } catch (error) {
                    console.error('Error parsing message:', error);
                }
            };
            
            socket.onclose = () => {
                console.log('ðŸ”Œ Disconnected from signaling server');
                updateConnectionStatus('Disconnected from server', 'error');
            };
        });
    }

    // Handle signaling messages from server
    function handleSignalingMessage(message) {
        switch (message.type) {
            case 'connected':
                console.log('Connected with client ID:', message.clientId);
                break;
            case 'room-created':
                handleRoomCreated(message);
                break;
            case 'room-joined':
                handleRoomJoined(message);
                break;
            case 'user-joined':
                handleUserJoined(message);
                break;
            case 'user-left':
                handleUserLeft(message);
                break;
            case 'offer':
                handleOffer(message);
                break;
            case 'answer':
                handleAnswer(message);
                break;
            case 'ice-candidate':
                handleIceCandidate(message);
                break;
            case 'error':
                showToast('Error: ' + message.message, true);
                break;
        }
    }

    // Send signaling message to server
    function sendSignalingMessage(message) {
        if (socket && socket.readyState === WebSocket.OPEN) {
            socket.send(JSON.stringify(message));
        } else {
            console.error('WebSocket not connected');
        }
    }

    // Get local media stream
    async function getLocalStream() {
        try {
            localStream = await navigator.mediaDevices.getUserMedia({
                video: { width: 1280, height: 720 },
                audio: true
            });
            
            localVideo.srcObject = localStream;
            console.log('âœ… Camera and microphone access granted');
        } catch (error) {
            console.error('Error accessing media devices:', error);
            throw error;
        }
    }

    // Create a new room
    async function createRoom() {
        try {
            roomId = roomIdInput.value.trim() || generateRoomId();
            console.log('Creating room:', roomId);
            
            // Connect to signaling server
            await connectSignalingServer();
            
            // Send create room message
            sendSignalingMessage({
                type: 'create-room',
                roomId: roomId
            });
            
        } catch (error) {
            console.error('Error creating room:', error);
            showToast('Error creating room: ' + error.message, true);
        }
    }

    // Join an existing room
    async function joinRoom() {
        try {
            roomId = roomIdInput.value.trim();
            
            if (!roomId) {
                showToast('Please enter a room ID', true);
                return;
            }
            
            console.log('Joining room:', roomId);
            
            // Connect to signaling server
            await connectSignalingServer();
            
            // Send join room message
            sendSignalingMessage({
                type: 'join-room',
                roomId: roomId
            });
            
        } catch (error) {
            console.error('Error joining room:', error);
            showToast('Error joining room: ' + error.message, true);
        }
    }

    // Handle room created response
    function handleRoomCreated(message) {
        console.log('âœ… Room created successfully');
        showCallInterface();
        currentRoomId.textContent = roomId;
        showToast(`Room "${roomId}" created. Share the ID with your friend.`);
        updateConnectionStatus('Waiting for participants...', 'warning');
    }

    // Handle room joined response
    function handleRoomJoined(message) {
        console.log('âœ… Joined room successfully');
        showCallInterface();
        currentRoomId.textContent = roomId;
        showToast(`Joined room "${roomId}"`);
        updateConnectionStatus('Waiting for participants...', 'warning');
        initializePeerConnection();
    }

    // Handle user joined room
    function handleUserJoined(message) {
        console.log('ðŸ‘¤ New participant joined');
        showToast('New participant joined the room');
        updateConnectionStatus('Participant joined, establishing connection...', 'warning');
        
        if (peerConnection) {
            createOffer();
        }
    }

    // Handle user left room
    function handleUserLeft(message) {
        console.log('ðŸ‘¤ Participant left');
        showToast('Participant left the room');
        
        if (peerConnection) {
            peerConnection.close();
            peerConnection = null;
        }
        
        remoteVideo.srcObject = null;
        remoteVideoIndicator.classList.remove('active');
        remoteStatusText.textContent = 'Disconnected';
        updateConnectionStatus('Participant disconnected', 'error');
    }

    // Show call interface
    function showCallInterface() {
        setupInterface.classList.add('hidden');
        callInterface.classList.remove('hidden');
    }

    // Initialize WebRTC peer connection
    async function initializePeerConnection() {
        try {
            if (peerConnection) {
                peerConnection.close();
            }
            
            peerConnection = new RTCPeerConnection(configuration);
            console.log('âœ… Peer connection initialized');
            
            // Add local stream tracks
            localStream.getTracks().forEach(track => {
                peerConnection.addTrack(track, localStream);
            });
            
            // Set up event handlers
            peerConnection.onicecandidate = (event) => {
                if (event.candidate) {
                    sendSignalingMessage({
                        type: 'ice-candidate',
                        candidate: event.candidate,
                        roomId: roomId
                    });
                }
            };
            
            peerConnection.ontrack = (event) => {
                console.log('âœ… Remote stream received');
                remoteVideo.srcObject = event.streams[0];
                remoteVideoIndicator.classList.add('active');
                remoteStatusText.textContent = 'Live';
                updateConnectionStatus('Connected to peer', 'success');
                showToast('Connected to remote participant');
            };
            
        } catch (error) {
            console.error('Error initializing peer connection:', error);
        }
    }

    // Create WebRTC offer
    async function createOffer() {
        try {
            console.log('ðŸ“¤ Creating WebRTC offer');
            const offer = await peerConnection.createOffer();
            await peerConnection.setLocalDescription(offer);
            
            sendSignalingMessage({
                type: 'offer',
                offer: offer,
                roomId: roomId
            });
        } catch (error) {
            console.error('Error creating offer:', error);
        }
    }

    // Handle incoming offer
    async function handleOffer(message) {
        try {
            console.log('ðŸ“¥ Handling WebRTC offer');
            if (!peerConnection) {
                await initializePeerConnection();
            }
            
            await peerConnection.setRemoteDescription(message.offer);
            const answer = await peerConnection.createAnswer();
            await peerConnection.setLocalDescription(answer);
            
            sendSignalingMessage({
                type: 'answer',
                answer: answer,
                roomId: roomId
            });
        } catch (error) {
            console.error('Error handling offer:', error);
        }
    }

    // Handle incoming answer
    async function handleAnswer(message) {
        try {
            console.log('ðŸ“¥ Handling WebRTC answer');
            await peerConnection.setRemoteDescription(message.answer);
        } catch (error) {
            console.error('Error handling answer:', error);
        }
    }

    // Handle incoming ICE candidate
    async function handleIceCandidate(message) {
        try {
            if (peerConnection) {
                await peerConnection.addIceCandidate(message.candidate);
            }
        } catch (error) {
            console.error('Error adding ICE candidate:', error);
        }
    }

    // Toggle video stream
    function toggleVideo() {
        if (!localStream) return;
        
        const videoTrack = localStream.getVideoTracks()[0];
        if (videoTrack) {
            videoTrack.enabled = !videoTrack.enabled;
            isVideoOn = videoTrack.enabled;
            
            toggleVideoBtn.innerHTML = isVideoOn ? 
                '<i class="fas fa-video"></i> Video On' : 
                '<i class="fas fa-video-slash"></i> Video Off';
            
            toggleVideoBtn.classList.toggle('active', isVideoOn);
            localVideoIndicator.classList.toggle('active', isVideoOn);
            
            showToast(`Video ${isVideoOn ? 'enabled' : 'disabled'}`);
        }
    }

    // Toggle audio stream
    function toggleAudio() {
        if (!localStream) return;
        
        const audioTrack = localStream.getAudioTracks()[0];
        if (audioTrack) {
            audioTrack.enabled = !audioTrack.enabled;
            isAudioOn = audioTrack.enabled;
            
            toggleAudioBtn.innerHTML = isAudioOn ? 
                '<i class="fas fa-microphone"></i> Audio On' : 
                '<i class="fas fa-microphone-slash"></i> Audio Off';
            
            toggleAudioBtn.classList.toggle('active', isAudioOn);
            
            showToast(`Audio ${isAudioOn ? 'enabled' : 'muted'}`);
        }
    }

    // Share screen
    async function shareScreen() {
        try {
            if (!isScreenSharing) {
                const screenStream = await navigator.mediaDevices.getDisplayMedia({
                    video: true
                });
                
                const videoTrack = screenStream.getVideoTracks()[0];
                const sender = peerConnection.getSenders().find(s => 
                    s.track && s.track.kind === 'video'
                );
                
                if (sender) {
                    await sender.replaceTrack(videoTrack);
                }
                
                screenShareBtn.innerHTML = '<i class="fas fa-stop"></i> Stop Sharing';
                screenShareBtn.classList.add('active');
                isScreenSharing = true;
                
                videoTrack.onended = () => {
                    stopScreenShare();
                };
                
                showToast('Screen sharing started');
            } else {
                stopScreenShare();
            }
        } catch (error) {
            console.error('Error sharing screen:', error);
        }
    }

    // Stop screen sharing
    async function stopScreenShare() {
        try {
            const originalVideoTrack = localStream.getVideoTracks()[0];
            const sender = peerConnection.getSenders().find(s => 
                s.track && s.track.kind === 'video'
            );
            
            if (sender && originalVideoTrack) {
                await sender.replaceTrack(originalVideoTrack);
            }
            
            screenShareBtn.innerHTML = '<i class="fas fa-desktop"></i> Share Screen';
            screenShareBtn.classList.remove('active');
            isScreenSharing = false;
            
            showToast('Screen sharing stopped');
        } catch (error) {
            console.error('Error stopping screen share:', error);
        }
    }

    // Copy room ID to clipboard
    function copyRoomId() {
        navigator.clipboard.writeText(roomId).then(() => {
            showToast('Room ID copied to clipboard!');
        }).catch(err => {
            showToast('Failed to copy room ID', true);
        });
    }

    // End the call
    function endCall() {
        console.log('ðŸ“ž Ending call');
        
        if (socket && roomId) {
            sendSignalingMessage({
                type: 'leave-room',
                roomId: roomId
            });
        }
        
        if (peerConnection) {
            peerConnection.close();
            peerConnection = null;
        }
        
        if (isScreenSharing) {
            stopScreenShare();
        }
        
        setupInterface.classList.remove('hidden');
        callInterface.classList.add('hidden');
        
        // Reset UI
        toggleVideoBtn.innerHTML = '<i class="fas fa-video"></i> Video On';
        toggleVideoBtn.classList.add('active');
        toggleAudioBtn.innerHTML = '<i class="fas fa-microphone"></i> Audio On';
        toggleAudioBtn.classList.add('active');
        screenShareBtn.innerHTML = '<i class="fas fa-desktop"></i> Share Screen';
        screenShareBtn.classList.remove('active');
        
        localVideoIndicator.classList.add('active');
        remoteVideoIndicator.classList.remove('active');
        remoteStatusText.textContent = 'Connecting...';
        
        updateConnectionStatus('Call ended', 'error');
        roomId = null;
        
        showToast('Call ended');
    }

    // Update connection status
    function updateConnectionStatus(message, type) {
        connectionStatusText.textContent = message;
        connectionStatusDot.className = 'status-dot';
        
        switch (type) {
            case 'success':
                connectionStatusDot.classList.add('connected');
                break;
            case 'warning':
                connectionStatusDot.style.background = '#ffc107';
                break;
            case 'error':
                connectionStatusDot.style.background = '#dc3545';
                break;
        }
    }

    // Generate a random room ID
    function generateRoomId() {
        return Math.random().toString(36).substring(2, 8).toUpperCase();
    }

    // Show toast notification
    function showToast(message, isError = false) {
        toastMessage.textContent = message;
        
        if (isError) {
            toast.style.background = '#dc3545';
            toast.querySelector('i').className = 'fas fa-exclamation-circle';
        } else {
            toast.style.background = '';
            toast.querySelector('i').className = 'fas fa-check-circle';
        }
        
        toast.classList.add('show');
        
        setTimeout(() => {
            toast.classList.remove('show');
        }, 3000);
    }

    // Set up event listeners
    function setupEventListeners() {
        createRoomBtn.addEventListener('click', createRoom);
        joinRoomBtn.addEventListener('click', joinRoom);
        toggleVideoBtn.addEventListener('click', toggleVideo);
        toggleAudioBtn.addEventListener('click', toggleAudio);
        screenShareBtn.addEventListener('click', shareScreen);
        endCallBtn.addEventListener('click', endCall);
        copyRoomIdBtn.addEventListener('click', copyRoomId);
    }

    // Initialize the app
    window.addEventListener('load', init);
</script>
</body>
</html>